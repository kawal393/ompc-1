<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="color-scheme" content="dark">
<title>APEX — OMPC / ATA</title>

<!-- City detection (no backend, client-side only) -->
<script src="https://cdn.jsdelivr.net/gh/bigdatacloudapi/js-reverse-geocode-client@latest/bigdatacloud_reverse_geocode.min.js"></script>

<style>
:root{
  --bg0:#050607; --bg1:#07090b;
  --panel:rgba(14,16,19,.75);
  --stroke:rgba(255,255,255,.08);
  --text:#e9edf3; --muted:#aeb7c2;
  --gold:#d2b25d; --blue:#77b6ff;
  --radius:18px; --radius2:26px;
  --max:1120px;
  --mono:ui-monospace,Menlo,Consolas,monospace;
  --sans:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
}
*{box-sizing:border-box}
html,body{margin:0;height:100%}
body{
  font-family:var(--sans);
  color:var(--text);
  background:
    radial-gradient(900px 500px at 50% 10%, rgba(210,178,93,.15), transparent 60%),
    radial-gradient(800px 600px at 20% 40%, rgba(120,190,255,.10), transparent 65%),
    linear-gradient(180deg,var(--bg0),var(--bg1));
  overflow-x:hidden;
}

/* PARTICLES */
#bg{position:fixed;inset:0;z-index:0;pointer-events:none}

/* BIG SIGIL */
.sigil{
  position:fixed; inset:-15%;
  display:grid; place-items:center;
  z-index:1; pointer-events:none;
  opacity:.22; mix-blend-mode:screen;
}
.sigil img{
  width:min(90vw,900px);
  filter:drop-shadow(0 0 40px rgba(210,178,93,.25));
}

/* CONTENT */
.wrap{position:relative;z-index:2;max-width:var(--max);margin:auto;padding:24px}

/* TOP BAR */
.topbar{
  display:flex;justify-content:space-between;align-items:center;
  padding:10px 14px;border:1px solid var(--stroke);
  border-radius:999px;background:rgba(0,0,0,.35);
  backdrop-filter:blur(10px)
}
.brand{display:flex;gap:12px;align-items:center}
.logo{width:42px;height:42px;border-radius:50%;overflow:hidden;border:1px solid rgba(210,178,93,.35)}
.logo img{width:100%;height:100%;object-fit:cover}
.kicker{font-size:12px;letter-spacing:.18em;color:var(--gold);text-transform:uppercase}
.sub{font-size:12px;color:var(--muted)}
.actions{display:flex;gap:8px}
.btn{
  border:1px solid rgba(210,178,93,.25);
  background:rgba(0,0,0,.25);
  color:var(--text);padding:8px 12px;
  border-radius:999px;font-size:12px;
  cursor:pointer;text-transform:uppercase;
}
.btn.gold{background:rgba(210,178,93,.18)}
.btn:hover{background:rgba(210,178,93,.25)}

/* HERO */
.hero{
  margin-top:18px;padding:22px;border-radius:var(--radius2);
  border:1px solid var(--stroke);
  background:rgba(0,0,0,.35);
}
.hero h1{margin:0;font-size:40px;line-height:1.05}
.hero p{max-width:65ch;color:var(--muted)}
.stats{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
.stat{font-size:12px;padding:6px 10px;border-radius:999px;
  background:rgba(0,0,0,.25);border:1px solid var(--stroke)
}

/* NAV */
.tabs{display:flex;gap:8px;margin-top:14px}
.tab{padding:8px 12px;border-radius:999px;border:1px solid var(--stroke);
  background:rgba(0,0,0,.25);cursor:pointer;font-size:12px}
.tab.active{background:rgba(210,178,93,.18)}

/* LEDGER */
.toolbar{display:flex;gap:10px;margin-top:14px;flex-wrap:wrap}
.search{flex:1;border:1px solid var(--stroke);border-radius:999px;padding:8px 12px;background:rgba(0,0,0,.25)}
.search input{background:none;border:0;color:var(--text);width:100%}
.grid{margin-top:14px;display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:12px}

.card{
  padding:12px;border-radius:var(--radius);
  background:rgba(0,0,0,.30);border:1px solid var(--stroke)
}
.id{font-family:var(--mono);font-size:11px;color:var(--gold)}
.name{font-weight:600}
.badge{font-size:11px;color:var(--gold)}
.cardActions{display:flex;gap:6px;margin-top:8px}
.mini{font-size:11px;padding:6px 10px;border-radius:999px;border:1px solid var(--stroke);
  background:rgba(0,0,0,.25);cursor:pointer}

/* MARKET LENS */
#lens{display:none;margin-top:16px}
#lens.open{display:block}
pre{font-family:var(--mono);font-size:12px;color:var(--text)}

/* MODAL */
.modal{position:fixed;inset:0;display:none;place-items:center;
  background:rgba(0,0,0,.7);z-index:9}
.modal.open{display:grid}
.modalBox{background:#0b0d10;border-radius:18px;padding:16px;
  max-width:900px;width:90%;max-height:85vh;overflow:auto}

.footer{text-align:center;margin:20px 0;font-size:12px;color:var(--muted)}
</style>
</head>

<body>
<canvas id="bg"></canvas>

<div class="sigil">
  <img src="./apex-sigil.png" alt="">
</div>

<div class="wrap">

<div class="topbar">
  <div class="brand">
    <div class="logo"><img src="./apex-sigil.png"></div>
    <div>
      <div class="kicker">APEX — OMPC / ATA</div>
      <div class="sub">Authority Registry · Market Lens</div>
    </div>
  </div>
  <div class="actions">
    <button class="btn" onclick="openRepo()">Repo</button>
    <button class="btn gold" onclick="copyPattern()">Copy Citation</button>
  </div>
</div>

<div class="hero">
  <h1>Authority you can cite.<br>Evidence you can anchor.</h1>
  <p>Public attestation ledger with a second intelligence layer that converts claims into structured signals.</p>
  <div class="stats">
    <div class="stat">Registry: <b id="statReg">—</b></div>
    <div class="stat">Entries: <b id="statCount">0</b></div>
    <div class="stat">Viewer: <b id="statCity">Locating…</b></div>
    <div class="stat">Timezone: <b id="statTZ">—</b></div>
  </div>
  <div class="tabs">
    <div class="tab active" onclick="showLedger(this)">Ledger</div>
    <div class="tab" onclick="showLens(this)">Market Lens</div>
  </div>
</div>

<div id="ledger">
  <div class="toolbar">
    <div class="search"><input id="q" placeholder="Search company, tag, ID…"></div>
  </div>
  <div class="grid" id="grid"></div>
</div>

<div id="lens">
  <div class="toolbar">
    <button class="btn gold" onclick="runLens()">Run Lens</button>
    <button class="btn" onclick="copyLens()">Copy Watchlist</button>
    <button class="btn" onclick="backToLedger()">Back</button>
  </div>
  <pre id="lensOut">Press “Run Lens”.</pre>
</div>

<div class="footer">© APEX · OMPC / ATA Surface</div>

</div>

<div class="modal" id="modal">
  <div class="modalBox">
    <button class="btn" onclick="closeModal()">Close</button>
    <pre id="modalBody"></pre>
  </div>
</div>

<script>
/* ---------- CORE ---------- */
const state={entries:[],watch:null};
const $=id=>document.getElementById(id);

/* BASE PATH */
const BASE=location.pathname.split("/")[1]?"/"+location.pathname.split("/")[1]+"/":"/";
const url=p=>new URL(p.replace(/^\//,""),location.origin+BASE);

/* LOAD REGISTRY */
async function load(){
  const r=await fetch(url("registry/index.json"));
  const j=await r.json();
  state.entries=j.entries.map(e=>({
    ...e,status:e.status==="verified"?"verified":"published"
  }));
  $("statReg").textContent="registry/index.json";
  $("statCount").textContent=state.entries.length;
  render();
}

/* RENDER */
function render(){
  const q=$("q").value.toLowerCase();
  $("grid").innerHTML=state.entries.filter(e=>
    !q||(`${e.id} ${e.name} ${(e.tags||[]).join(" ")}`.toLowerCase().includes(q))
  ).map(e=>`
    <div class="card">
      <div class="id">${e.id}</div>
      <div class="name">${e.name}</div>
      <div class="badge">${e.status}</div>
      <div class="cardActions">
        <button class="mini" onclick="openEntry('${e.entry_path}')">Open</button>
        <button class="mini" onclick="copyCitation('${e.id}')">Citation</button>
      </div>
    </div>`).join("");
}

/* MODAL */
async function openEntry(p){
  const t=await fetch(url(p)).then(r=>r.text());
  $("modalBody").textContent=t;
  $("modal").classList.add("open");
}
function closeModal(){$("modal").classList.remove("open")}

/* MARKET LENS */
function showLens(el){
  document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active"));
  el.classList.add("active");
  $("ledger").style.display="none";
  $("lens").classList.add("open");
}
function showLedger(el){
  document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active"));
  el.classList.add("active");
  $("lens").classList.remove("open");
  $("ledger").style.display="block";
}
function backToLedger(){showLedger(document.querySelector(".tab"))}
function runLens(){
  state.watch={generated:new Date().toISOString(),items:state.entries};
  $("lensOut").textContent=JSON.stringify(state.watch,null,2);
}
function copyLens(){navigator.clipboard.writeText($("lensOut").textContent)}

/* UTIL */
function copyCitation(id){
  navigator.clipboard.writeText("APEX/ATA · "+id);
}
function copyPattern(){
  navigator.clipboard.writeText("APEX/ATA Citation: {ID} · {ENTITY} · {DATE} · {SOURCE}");
}
function openRepo(){window.open("https://github.com/kawal393/ompc-1")}

/* CITY DETECT */
(function(){
  $("statTZ").textContent=Intl.DateTimeFormat().resolvedOptions().timeZone;
  try{
    const geo=new BDCReverseGeocode();
    geo.getClientLocation(r=>{
      $("statCity").textContent=r.city||r.locality||$("statTZ").textContent.split("/").pop();
    });
  }catch{
    $("statCity").textContent=$("statTZ").textContent.split("/").pop();
  }
})();

/* PARTICLES */
(function(){
  const c=$("bg"),ctx=c.getContext("2d");
  let w,h,p=[];
  function resize(){w=c.width=innerWidth;h=c.height=innerHeight}
  function seed(){p=[...Array(140)].map(()=>({x:Math.random()*w,y:Math.random()*h,vx:.3-Math.random()*.6,vy:.3-Math.random()*.6}))}
  function tick(){
    ctx.clearRect(0,0,w,h);
    for(const a of p){
      a.x+=a.vx;a.y+=a.vy;
      if(a.x<0||a.x>w)a.vx*=-1;
      if(a.y<0||a.y>h)a.vy*=-1;
      ctx.fillStyle="rgba(210,178,93,.6)";
      ctx.beginPath();ctx.arc(a.x,a.y,2,0,7);ctx.fill();
      for(const b of p){
        const d=Math.hypot(a.x-b.x,a.y-b.y);
        if(d<160){
          ctx.strokeStyle="rgba(210,178,93,"+(1-d/160)*.25+")";
          ctx.beginPath();ctx.moveTo(a.x,a.y);ctx.lineTo(b.x,b.y);ctx.stroke();
        }
      }
    }
    requestAnimationFrame(tick);
  }
  resize();seed();tick();addEventListener("resize",()=>{resize();seed()});
})();

/* INIT */
$("q").oninput=render;
load();
</script>
</body>
</html>
