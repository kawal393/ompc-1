<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="color-scheme" content="dark" />
  <title>APEX — OMPC / ATA Surface</title>
  <style>
    :root{
      --bg:#05070b;
      --panel: rgba(12,14,18,.68);
      --panel2: rgba(12,14,18,.52);
      --line: rgba(255,255,255,.10);
      --line2: rgba(255,255,255,.06);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.62);
      --muted2: rgba(255,255,255,.44);
      --gold: rgba(214,172,87,.95);
      --gold2: rgba(214,172,87,.55);
      --shadow: 0 18px 55px rgba(0,0,0,.52);
      --r: 18px;
      --r2: 14px;
      --max: 1120px;
      --pad: clamp(14px, 4vw, 26px);
      --font: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family:var(--font);
      background: radial-gradient(1200px 700px at 50% -10%, rgba(214,172,87,.12), transparent 55%),
                  radial-gradient(900px 520px at 5% 30%, rgba(110,180,255,.08), transparent 55%),
                  radial-gradient(900px 520px at 95% 30%, rgba(255,140,110,.06), transparent 55%),
                  linear-gradient(180deg, #05070b 0%, #06070a 40%, #05060a 100%);
      color:var(--text);
      overflow-x:hidden;
    }

    /* BACKGROUND LAYERS */
    #particles{
      position:fixed;
      inset:0;
      z-index:0;
      pointer-events:none;
      opacity:.85;
    }
    .sigil{
      position:fixed;
      inset:auto 0 -8% 0;
      height:min(72vh, 820px);
      z-index:1;
      pointer-events:none;
      display:flex;
      align-items:flex-end;
      justify-content:center;
      opacity:.62; /* make it visible */
      filter: saturate(1.05) contrast(1.08);
      mix-blend-mode: screen;
    }
    .sigil img{
      width:min(92vw, 920px);
      height:auto;
      filter: drop-shadow(0 40px 90px rgba(0,0,0,.65));
      opacity:.95;
    }
    .vignette{
      position:fixed; inset:0;
      z-index:2;
      pointer-events:none;
      background:
        radial-gradient(900px 520px at 50% 18%, rgba(0,0,0,.02), rgba(0,0,0,.45) 60%, rgba(0,0,0,.72) 100%),
        linear-gradient(180deg, rgba(0,0,0,.30), rgba(0,0,0,.62));
    }

    /* CONTENT */
    .wrap{
      position:relative;
      z-index:10; /* always above particles + sigil */
      padding: calc(var(--pad) + env(safe-area-inset-top)) var(--pad) calc(var(--pad) + env(safe-area-inset-bottom));
      display:flex;
      justify-content:center;
    }
    .container{
      width:100%;
      max-width:var(--max);
    }

    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding: 10px 12px;
      border: 1px solid var(--line2);
      border-radius: 999px;
      background: rgba(8,10,14,.55);
      backdrop-filter: blur(10px);
      box-shadow: 0 10px 40px rgba(0,0,0,.35);
    }
    .brand{
      display:flex; align-items:center; gap:10px; min-width:0;
    }
    .brand img{
      width:28px; height:28px; border-radius:10px;
      box-shadow: 0 10px 25px rgba(0,0,0,.35);
      border:1px solid rgba(255,255,255,.10);
    }
    .brand .t{
      line-height:1.1;
      min-width:0;
    }
    .brand .t b{
      font-size:12px; letter-spacing:.12em; text-transform:uppercase;
      display:block;
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }
    .brand .t span{
      font-size:11px; color:var(--muted);
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
      display:block;
    }

    .chiprow{ display:flex; gap:8px; align-items:center; flex-wrap:wrap; justify-content:flex-end; }
    .chip{
      display:inline-flex; align-items:center; gap:8px;
      padding:7px 10px;
      border-radius:999px;
      border:1px solid var(--line2);
      background: rgba(10,12,16,.55);
      backdrop-filter: blur(10px);
      font-size:11px;
      color:var(--muted);
    }
    .dot{
      width:8px; height:8px; border-radius:50%;
      background:#2fe18a;
      box-shadow: 0 0 0 3px rgba(47,225,138,.12), 0 0 22px rgba(47,225,138,.35);
    }
    .btn{
      display:inline-flex; align-items:center; justify-content:center;
      gap:8px;
      padding:9px 12px;
      border-radius:999px;
      border:1px solid rgba(214,172,87,.35);
      background: linear-gradient(180deg, rgba(214,172,87,.12), rgba(214,172,87,.05));
      color: rgba(255,255,255,.90);
      font-size:12px;
      cursor:pointer;
      user-select:none;
      text-decoration:none;
      transition: transform .12s ease, border-color .12s ease, background .12s ease;
      white-space:nowrap;
    }
    .btn:active{ transform: scale(.98); }
    .btn.ghost{
      border:1px solid var(--line2);
      background: rgba(12,14,18,.45);
      color: var(--muted);
    }

    .hero{
      margin-top:14px;
      border-radius: calc(var(--r) + 6px);
      border:1px solid var(--line2);
      background: radial-gradient(900px 420px at 50% 0%, rgba(214,172,87,.11), transparent 55%),
                  linear-gradient(180deg, rgba(12,14,18,.72), rgba(12,14,18,.52));
      box-shadow: var(--shadow);
      overflow:hidden;
      position:relative;
    }
    .hero:before{
      content:"";
      position:absolute; inset:-2px;
      background: radial-gradient(600px 280px at 20% 10%, rgba(110,180,255,.08), transparent 60%),
                  radial-gradient(600px 280px at 80% 10%, rgba(255,140,110,.06), transparent 60%);
      pointer-events:none;
    }
    .heroInner{
      position:relative;
      padding: 18px;
    }
    h1{
      margin:0;
      font-size: clamp(26px, 5.5vw, 42px);
      letter-spacing:-.02em;
      line-height:1.05;
    }
    .sub{
      margin-top:8px;
      color: var(--muted);
      font-size: 13px;
      line-height:1.45;
      max-width: 72ch;
    }
    .ctaRow{
      margin-top:14px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
    }

    .stats{
      margin-top:14px;
      display:grid;
      grid-template-columns: repeat(12, 1fr);
      gap:10px;
    }
    .card{
      grid-column: span 12;
      padding:12px 12px;
      border-radius: var(--r2);
      border:1px solid var(--line2);
      background: rgba(10,12,16,.40);
      backdrop-filter: blur(12px);
    }
    .card b{ display:block; font-size:12px; letter-spacing:.12em; text-transform:uppercase; color: rgba(255,255,255,.78); }
    .card .v{ margin-top:6px; font-size:12px; color:var(--muted); display:flex; gap:10px; flex-wrap:wrap; }
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding:7px 10px;
      border-radius:999px;
      border:1px solid var(--line2);
      background: rgba(12,14,18,.55);
    }
    .pill em{ font-style:normal; color: rgba(255,255,255,.85); }
    .pill small{ color: var(--muted2); }

    @media (min-width: 760px){
      .card{ grid-column: span 6; }
    }

    .panel{
      margin-top: 14px;
      border-radius: calc(var(--r) + 6px);
      border:1px solid var(--line2);
      background: linear-gradient(180deg, rgba(12,14,18,.70), rgba(12,14,18,.44));
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .panelHead{
      padding: 12px 14px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      border-bottom:1px solid var(--line2);
    }
    .panelHead .left{
      display:flex; align-items:center; gap:10px; flex-wrap:wrap;
    }
    .search{
      flex: 1 1 240px;
      min-width: 180px;
      display:flex;
      align-items:center;
      padding:10px 12px;
      border-radius: 999px;
      border:1px solid var(--line2);
      background: rgba(8,10,14,.55);
      color: rgba(255,255,255,.84);
      outline:none;
    }
    .select{
      padding:10px 12px;
      border-radius: 999px;
      border:1px solid var(--line2);
      background: rgba(8,10,14,.55);
      color: rgba(255,255,255,.84);
      outline:none;
    }

    .grid{
      padding: 12px 14px 16px;
      display:grid;
      grid-template-columns: repeat(12, 1fr);
      gap:10px;
    }
    .entry{
      grid-column: span 12;
      padding: 12px;
      border-radius: var(--r2);
      border:1px solid var(--line2);
      background: rgba(10,12,16,.40);
      backdrop-filter: blur(12px);
      position:relative;
      overflow:hidden;
    }
    .entry:before{
      content:"";
      position:absolute; inset:-1px;
      background: radial-gradient(420px 160px at 30% 0%, rgba(214,172,87,.10), transparent 60%);
      opacity:.9;
      pointer-events:none;
    }
    .entry .in{ position:relative; }
    .entryTop{
      display:flex; align-items:flex-start; justify-content:space-between; gap:10px;
    }
    .id{
      font-size:12px;
      letter-spacing:.12em;
      text-transform:uppercase;
      color: rgba(214,172,87,.92);
    }
    .name{
      margin-top:6px;
      font-size: 18px;
      letter-spacing:-.01em;
    }
    .meta{
      margin-top:6px;
      color: var(--muted);
      font-size: 12px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
    }
    .badge{
      display:inline-flex; align-items:center; gap:8px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(214,172,87,.25);
      background: rgba(214,172,87,.08);
      font-size:11px;
      color: rgba(255,255,255,.78);
    }
    .tags{
      margin-top:10px;
      display:flex;
      gap:8px;
      flex-wrap:wrap;
    }
    .tag{
      padding:6px 10px;
      border-radius:999px;
      border:1px solid var(--line2);
      background: rgba(12,14,18,.55);
      color: var(--muted);
      font-size:11px;
    }
    .actions{
      margin-top:12px;
      display:flex;
      gap:8px;
      flex-wrap:wrap;
    }

    @media (min-width: 760px){
      .entry{ grid-column: span 6; }
    }
    @media (min-width: 1060px){
      .entry{ grid-column: span 4; }
    }

    .footer{
      margin-top:14px;
      padding: 12px 2px 0;
      color: rgba(255,255,255,.42);
      font-size:11px;
      display:flex;
      justify-content:space-between;
      flex-wrap:wrap;
      gap:8px;
    }
    a{ color: rgba(214,172,87,.90); }
    .toast{
      position: fixed;
      left: 50%;
      bottom: 18px;
      transform: translateX(-50%);
      background: rgba(10,12,16,.82);
      border:1px solid var(--line2);
      border-radius: 999px;
      padding: 10px 14px;
      z-index: 9999;
      color: rgba(255,255,255,.88);
      font-size: 12px;
      box-shadow: 0 18px 55px rgba(0,0,0,.55);
      opacity: 0;
      pointer-events:none;
      transition: opacity .2s ease, transform .2s ease;
    }
    .toast.show{
      opacity: 1;
      transform: translateX(-50%) translateY(-4px);
    }
  </style>
</head>

<body>
  <canvas id="particles"></canvas>

  <div class="sigil" aria-hidden="true">
    <img src="./apex-sigil.png" alt="">
  </div>
  <div class="vignette" aria-hidden="true"></div>

  <div class="wrap">
    <div class="container">
      <div class="topbar">
        <div class="brand">
          <img src="./apex-sigil.png" alt="APEX" />
          <div class="t">
            <b>APEX — OMPC / ATA</b>
            <span>Authority Registry • Claims vs Reality • Market Lens</span>
          </div>
        </div>

        <div class="chiprow">
          <div class="chip"><span class="dot"></span><span id="liveLabel">LIVE SURFACE</span></div>
          <div class="chip" id="nowChip">—</div>
          <a class="btn ghost" id="repoBtn" href="#" target="_blank" rel="noreferrer">REPO</a>
          <button class="btn" id="copyPatternBtn" type="button">COPY CITATION PATTERN</button>
        </div>
      </div>

      <div class="hero">
        <div class="heroInner">
          <h1>Authority you can cite.<br/>Evidence you can anchor.</h1>
          <div class="sub">
            Public ledger of records (ATA/OMPC). Second layer becomes the product:
            watchlists, contradictions, catalysts, timelines. Clean. Calm. Weapon-grade.
          </div>

          <div class="ctaRow">
            <button class="btn" id="enterLedgerBtn" type="button">ENTER LEDGER</button>
            <button class="btn ghost" id="openLensBtn" type="button">OPEN MARKET LENS</button>
            <button class="btn ghost" id="forceRefreshBtn" type="button">FORCE REFRESH</button>
          </div>

          <div class="stats">
            <div class="card">
              <b>Registry</b>
              <div class="v">
                <span class="pill"><em id="regMode">Auto-index</em> <small id="regPath">./entries/_index.json</small></span>
                <span class="pill"><em id="entryCount">0</em> <small>entries</small></span>
              </div>
            </div>
            <div class="card">
              <b>Viewer</b>
              <div class="v">
                <span class="pill"><em id="viewerCity">—</em> <small>city</small></span>
                <span class="pill"><em id="viewerTZ">—</em> <small>timezone</small></span>
                <span class="pill"><em id="viewerLocale">—</em> <small>locale</small></span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="panel" id="ledgerPanel">
        <div class="panelHead">
          <div class="left" style="flex:1;">
            <input class="search" id="search" placeholder="Search: company, tags, ID, jurisdiction..." />
            <select class="select" id="statusFilter">
              <option value="all">Status: All</option>
              <option value="unverified">Unverified</option>
              <option value="verified">Verified</option>
              <option value="tracking">Tracking</option>
              <option value="archived">Archived</option>
            </select>
          </div>
          <div class="chip" id="metaChip">Entries: 0 • Updated: —</div>
        </div>
        <div class="grid" id="grid"></div>
      </div>

      <div class="footer">
        <div>© <span id="year"></span> APEX • OMPC / ATA Surface</div>
        <div>
          Data: <span id="dataHint">—</span>
        </div>
      </div>
    </div>
  </div>

  <div class="toast" id="toast"></div>

<script>
/* =========================
   BASE PATH (fixes your “entries not loading”)
   Works on:
   - https://kawal393.github.io/ompc-1/
   - custom domains
   ========================= */
const BASE = new URL('.', window.location.href);
const url = (p) => new URL(p, BASE).toString();

/* Repo button */
document.getElementById('repoBtn').href = "https://github.com/kawal393/ompc-1";

/* =========================
   TIME + CITY (viewer)
   ========================= */
const nowChip = document.getElementById('nowChip');
const viewerTZ = document.getElementById('viewerTZ');
const viewerLocale = document.getElementById('viewerLocale');
const viewerCity = document.getElementById('viewerCity');

function prettyCityFromTZ(tz){
  if (!tz) return "Unknown";
  const parts = tz.split('/');
  if (parts.length === 1) return tz;
  const city = parts[parts.length - 1].replaceAll('_',' ');
  return city || tz;
}

function tickClock(){
  const locale = navigator.language || 'en-AU';
  const tz = Intl.DateTimeFormat().resolvedOptions().timeZone || 'UTC';
  const d = new Date();

  const fmt = new Intl.DateTimeFormat(locale, {
    weekday:'short', year:'numeric', month:'2-digit', day:'2-digit',
    hour:'2-digit', minute:'2-digit', second:'2-digit',
    hour12:false, timeZone: tz
  });

  nowChip.textContent = fmt.format(d) + " • " + tz;
  viewerTZ.textContent = tz;
  viewerLocale.textContent = locale;
  viewerCity.textContent = prettyCityFromTZ(tz);
}
setInterval(tickClock, 1000);
tickClock();

document.getElementById('year').textContent = new Date().getFullYear();

/* =========================
   TOAST
   ========================= */
const toast = document.getElementById('toast');
let toastTimer = null;
function showToast(msg){
  toast.textContent = msg;
  toast.classList.add('show');
  clearTimeout(toastTimer);
  toastTimer = setTimeout(()=>toast.classList.remove('show'), 1600);
}

/* =========================
   DATA LOADING (registry/index.json OR entries/_index.json)
   ========================= */
const grid = document.getElementById('grid');
const metaChip = document.getElementById('metaChip');
const entryCount = document.getElementById('entryCount');
const regMode = document.getElementById('regMode');
const regPath = document.getElementById('regPath');
const dataHint = document.getElementById('dataHint');

let ALL = [];
let UPDATED = null;

async function fetchJSON(path){
  const res = await fetch(url(path), { cache: "no-store" });
  if (!res.ok) throw new Error(`${path} -> ${res.status}`);
  return await res.json();
}

async function loadData(){
  grid.innerHTML = "";
  metaChip.textContent = "Loading…";
  regMode.textContent = "Auto-index";
  regPath.textContent = "./entries/_index.json";
  dataHint.textContent = "Loading…";

  // Prefer registry/index.json (your richer schema)
  try {
    const reg = await fetchJSON("registry/index.json");
    if (reg && Array.isArray(reg.entries) && reg.entries.length){
      ALL = reg.entries.map(e => ({
        id: e.id || "",
        name: e.name || "",
        type: e.type || "",
        jurisdiction: e.jurisdiction || "",
        scope: e.scope || "",
        status: (e.status || "unverified").toLowerCase(),
        tags: Array.isArray(e.tags) ? e.tags : [],
        summary: e.summary || "Public attestation record. Presence-only. Source-anchored.",
        source_url: e.source_url || "",
        entry_path: e.entry_path || ""
      }));
      UPDATED = reg.updated || null;
      regMode.textContent = "Registry";
      regPath.textContent = "./registry/index.json";
      dataHint.textContent = "registry/index.json";
      return;
    }
  } catch (_) {}

  // Fallback: entries/_index.json (simple file list)
  // Supports either:
  // 1) { "files": ["ATA-2026-0001-BHP.md", ...] }
  // 2) ["ATA-2026-0001-BHP.md", ...]
  try {
    const idx = await fetchJSON("entries/_index.json");
    const files = Array.isArray(idx) ? idx : (Array.isArray(idx.files) ? idx.files : []);
    if (!files.length) throw new Error("No files in _index.json");

    ALL = files.map((fn) => {
      const base = fn.replace(/\.md$/i,"");
      const parts = base.split("-");
      const id = parts.slice(0,3).join("-"); // ATA-2026-0001
      const name = parts.slice(3).join(" ").replaceAll("_"," ").trim() || base;
      return {
        id,
        name,
        type: "Public Record",
        jurisdiction: "—",
        scope: "—",
        status: "unverified",
        tags: [],
        summary: "Public attestation record. Presence-only. Source-anchored.",
        source_url: "",
        entry_path: `./entries/${fn}`
      };
    });
    UPDATED = null;
    regMode.textContent = "Auto-index";
    regPath.textContent = "./entries/_index.json";
    dataHint.textContent = "entries/_index.json";
    return;
  } catch (e) {
    ALL = [];
    UPDATED = null;
    dataHint.textContent = "NO INDEX FOUND";
    throw e;
  }
}

function escapeHTML(s){
  return (s||"").replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));
}

function badgeLabel(status){
  const s = (status || "unverified").toLowerCase();
  if (s === "verified") return "Verified";
  if (s === "tracking") return "Tracking";
  if (s === "archived") return "Archived";
  return "Unverified";
}

function normalize(s){ return (s||"").toLowerCase().trim(); }

function applyFilters(){
  const q = normalize(document.getElementById('search').value);
  const status = document.getElementById('statusFilter').value;

  const filtered = ALL.filter(e => {
    const hay = normalize([e.id, e.name, e.type, e.jurisdiction, e.scope, e.summary, ...(e.tags||[])].join(" "));
    const okQ = !q || hay.includes(q);
    const okS = (status === "all") || normalize(e.status) === status;
    return okQ && okS;
  });

  render(filtered);
}

function render(list){
  grid.innerHTML = "";
  entryCount.textContent = String(list.length);

  const updatedText = UPDATED ? UPDATED : "—";
  metaChip.textContent = `Entries: ${list.length} • Updated: ${updatedText}`;

  if (!list.length){
    const div = document.createElement('div');
    div.className = 'entry';
    div.style.gridColumn = 'span 12';
    div.innerHTML = `<div class="in">
      <div class="name">No matches.</div>
      <div class="meta">Change filters or search again.</div>
    </div>`;
    grid.appendChild(div);
    return;
  }

  for (const e of list){
    const div = document.createElement('div');
    div.className = 'entry';

    const tags = (e.tags || []).slice(0,6).map(t => `<span class="tag">${escapeHTML(String(t))}</span>`).join("");
    const openURL = e.entry_path ? url(e.entry_path.replace(/^\.\//,'')) : "";
    const sourceURL = e.source_url || "";

    // Citation pattern (stable)
    const citation = `${e.id || "ATA-YYYY-NNNN"} — ${e.name || "Entity"} (APEX OMPC/ATA) • Source: ${sourceURL || "[source-url]"} • Record: ${openURL || "[record-url]"}`;

    div.innerHTML = `
      <div class="in">
        <div class="entryTop">
          <div>
            <div class="id">${escapeHTML(e.id)}</div>
            <div class="name">${escapeHTML(e.name)}</div>
            <div class="meta">
              <span>${escapeHTML(e.type || "Public Record")}</span>
              <span>•</span>
              <span>${escapeHTML(e.jurisdiction || "—")}</span>
              <span>•</span>
              <span>${escapeHTML(e.scope || "—")}</span>
            </div>
          </div>
          <span class="badge">${badgeLabel(e.status)}</span>
        </div>

        <div class="meta" style="margin-top:10px;">${escapeHTML(e.summary || "")}</div>

        <div class="tags">${tags || `<span class="tag">Resources</span><span class="tag">Infrastructure</span>`}</div>

        <div class="actions">
          <a class="btn" href="${openURL}" target="_blank" rel="noreferrer">OPEN</a>
          <button class="btn ghost" type="button" data-cite="${escapeHTML(citation)}">COPY CITATION</button>
          ${sourceURL ? `<a class="btn ghost" href="${escapeHTML(sourceURL)}" target="_blank" rel="noreferrer">SOURCE</a>` : `<span class="btn ghost" style="opacity:.55; pointer-events:none;">SOURCE</span>`}
        </div>
      </div>
    `;
    grid.appendChild(div);
  }

  // Bind copy buttons
  grid.querySelectorAll('button[data-cite]').forEach(btn=>{
    btn.addEventListener('click', async ()=>{
      const text = btn.getAttribute('data-cite') || '';
      try{
        await navigator.clipboard.writeText(text);
        showToast("Citation copied.");
      }catch{
        showToast("Copy failed (browser).");
      }
    });
  });
}

/* =========================
   ACTIONS
   ========================= */
document.getElementById('search').addEventListener('input', applyFilters);
document.getElementById('statusFilter').addEventListener('change', applyFilters);

document.getElementById('copyPatternBtn').addEventListener('click', async ()=>{
  const pattern = `ATA-YYYY-NNNN — Entity Name (APEX OMPC/ATA) • Source: [source-url] • Record: [record-url]`;
  try{
    await navigator.clipboard.writeText(pattern);
    showToast("Citation pattern copied.");
  }catch{
    showToast("Copy failed (browser).");
  }
});

document.getElementById('forceRefreshBtn').addEventListener('click', async ()=>{
  try{
    await boot(true);
    showToast("Refreshed.");
  }catch{
    showToast("Refresh failed.");
  }
});

document.getElementById('enterLedgerBtn').addEventListener('click', ()=>{
  document.getElementById('ledgerPanel').scrollIntoView({ behavior:'smooth', block:'start' });
});

document.getElementById('openLensBtn').addEventListener('click', ()=>{
  showToast("Market Lens: coming online.");
});

/* =========================
   BOOT
   ========================= */
async function boot(isRefresh=false){
  try{
    await loadData();
    UPDATED = UPDATED || (new Date()).toISOString().slice(0,10);
    applyFilters();
  }catch(e){
    metaChip.textContent = "NO INDEX FOUND • Fix entries/_index.json or registry/index.json";
    entryCount.textContent = "0";
    grid.innerHTML = `
      <div class="entry" style="grid-column: span 12;">
        <div class="in">
          <div class="name">Auto-index needs data.</div>
          <div class="meta" style="margin-top:8px;">
            Put one of these in the repo:
            <br><br>
            <b style="color:rgba(255,255,255,.82)">Option A (recommended):</b> <span style="color:rgba(255,255,255,.62)">registry/index.json</span>
            <br>
            <b style="color:rgba(255,255,255,.82)">Option B:</b> <span style="color:rgba(255,255,255,.62)">entries/_index.json</span> with a file list
            <br><br>
            <span style="color:rgba(255,255,255,.55)">${escapeHTML(String(e.message || e))}</span>
          </div>
        </div>
      </div>
    `;
  }
}
boot();

/* =========================
   PARTICLES (moving background)
   Always behind content + logo. Never blocks clicks.
   ========================= */
const canvas = document.getElementById('particles');
const ctx = canvas.getContext('2d');
let W=0, H=0, DPR=1;
let P=[];
const N = 88;

function resize(){
  DPR = Math.min(2, window.devicePixelRatio || 1);
  W = Math.floor(window.innerWidth);
  H = Math.floor(window.innerHeight);
  canvas.width = Math.floor(W * DPR);
  canvas.height = Math.floor(H * DPR);
  canvas.style.width = W + "px";
  canvas.style.height = H + "px";
  ctx.setTransform(DPR,0,0,DPR,0,0);

  if (!P.length){
    for (let i=0;i<N;i++){
      P.push({
        x: Math.random()*W,
        y: Math.random()*H,
        vx: (Math.random()-.5)*0.22,
        vy: (Math.random()-.5)*0.22,
        r: 1 + Math.random()*1.6,
        a: .18 + Math.random()*.22
      });
    }
  }
}
window.addEventListener('resize', resize, { passive:true });
resize();

function line(a,b,alpha){
  ctx.globalAlpha = alpha;
  ctx.beginPath();
  ctx.moveTo(a.x,a.y);
  ctx.lineTo(b.x,b.y);
  ctx.stroke();
}

function frame(){
  ctx.clearRect(0,0,W,H);

  // dots
  for (const p of P){
    p.x += p.vx; p.y += p.vy;
    if (p.x< -20) p.x = W+20;
    if (p.x> W+20) p.x = -20;
    if (p.y< -20) p.y = H+20;
    if (p.y> H+20) p.y = -20;
  }

  // glow field
  const g = ctx.createRadialGradient(W*0.5,H*0.2, 0, W*0.5,H*0.2, Math.max(W,H));
  g.addColorStop(0, "rgba(214,172,87,0.06)");
  g.addColorStop(0.55, "rgba(110,180,255,0.03)");
  g.addColorStop(1, "rgba(0,0,0,0)");
  ctx.globalAlpha = 1;
  ctx.fillStyle = g;
  ctx.fillRect(0,0,W,H);

  // lines
  ctx.lineWidth = 1;
  ctx.strokeStyle = "rgba(214,172,87,0.18)";
  for (let i=0;i<P.length;i++){
    for (let j=i+1;j<P.length;j++){
      const a = P[i], b = P[j];
      const dx = a.x-b.x, dy = a.y-b.y;
      const d2 = dx*dx + dy*dy;
      if (d2 < 140*140){
        const d = Math.sqrt(d2);
        const alpha = (1 - d/140) * 0.22;
        line(a,b,alpha);
      }
    }
  }

  // dots
  for (const p of P){
    ctx.globalAlpha = p.a;
    ctx.fillStyle = "rgba(255,255,255,0.85)";
    ctx.beginPath();
    ctx.arc(p.x,p.y,p.r,0,Math.PI*2);
    ctx.fill();
  }

  requestAnimationFrame(frame);
}
frame();
</script>
</body>
</html>
